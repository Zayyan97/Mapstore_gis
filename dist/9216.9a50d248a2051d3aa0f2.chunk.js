(self.webpackChunkMyMapStoreProject=self.webpackChunkMyMapStoreProject||[]).push([[9216],{2400:(t,e,i)=>{"use strict";i.d(e,{Z:()=>v});var o=i(24852),r=i.n(o),s=i(19690),n=i(27418),a=i.n(n),p=i(45697),h=i.n(p),l=i(59854),c=i.n(l),m=i(14293),d=i.n(m),u=i(52259);function y(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class g extends r().Component{constructor(){super(...arguments),y(this,"updateZIndex",(t=>{const e=t||this.props.position;if(this.provider){const t=this.props.map.imageryLayers._layers.indexOf(this.provider),i=[...this.props.map.imageryLayers._layers].sort(((t,i)=>(t===this.provider?e:t._position)-(i===this.provider?e:i._position))).indexOf(this.provider)-t;0!==i&&[...new Array(Math.abs(i)).keys()].forEach((()=>{this.props.map.imageryLayers[i>0?"raise":"lower"](this.provider)}))}})),y(this,"setLayerVisibility",(t=>{const e=this.getVisibilityOption(this.props),i=this.getVisibilityOption(t);i!==e&&(i?(this.addLayer(t),this.updateZIndex()):this.removeLayer())})),y(this,"getVisibilityOption",(t=>{const{options:e={},zoom:i,resolutions:o=(0,u.getResolutions)()}=t,r=c()(i),{visibility:s,minResolution:n=-1/0,maxResolution:a=1/0,disableResolutionLimits:p}=e||{};if(!p&&!d()(o[r])){const t=o[r];if(!(t<a&&t>=n))return!1}return!1!==s})),y(this,"setLayerOpacity",(t=>{t!==(this.props.options&&void 0!==this.props.options.opacity?this.props.options.opacity:1)&&this.layer&&this.provider&&(this.provider.alpha=t)})),y(this,"createLayer",((t,e,i,o,r)=>{if(t){const n=a()({},e,i?{zIndex:i}:null,{securityToken:r});this.layer=s.default.createLayer(t,n,o),this.layer&&(this.layer.layerName=e.name,this.layer.layerId=e.id),null===this.layer&&this.props.onCreationError(e)}})),y(this,"updateLayer",((t,e)=>{const i=s.default.updateLayer(t.type,this.layer,{...t.options,securityToken:t.securityToken},{...e.options,securityToken:e.securityToken},this.props.map);i&&(this.removeLayer(),this.layer=i,this.addLayer(t))})),y(this,"addLayerInternal",(t=>{t.options.useForElevation?this.props.map.terrainProvider=this.layer:(this.provider=this.props.map.imageryLayers.addImageryProvider(this.layer),this.provider._position=this.props.position,void 0!==t.options.opacity&&(this.provider.alpha=t.options.opacity))})),y(this,"addLayer",(t=>{if(this.layer&&!this.layer.detached&&(this.addLayerInternal(t),this.props.options.refresh&&this.layer.updateParams)){let e=0;this.refreshTimer=setInterval((()=>{const i=this.layer.updateParams(a()({},this.props.options.params,{_refreshCounter:e++}));this.removeLayer(),this.layer=i,this.addLayerInternal(t)}),this.props.options.refresh)}})),y(this,"removeLayer",(t=>{const e=t||this.provider;e&&this.props.map.imageryLayers.remove(e),this.layer?.detached&&this.layer?.remove&&this.layer.remove()}))}componentDidMount(){this.createLayer(this.props.type,this.props.options,this.props.position,this.props.map,this.props.securityToken),this.props.options&&this.layer&&this.getVisibilityOption(this.props)&&(this.addLayer(this.props),this.updateZIndex())}UNSAFE_componentWillReceiveProps(t){this.setLayerVisibility(t);const e=t.options&&void 0!==t.options.opacity?t.options.opacity:1;if(this.setLayerOpacity(e),t.position!==this.props.position&&(this.updateZIndex(t.position),this.provider&&(this.provider._position=t.position)),this.props.options&&this.props.options.params&&this.layer.updateParams&&t.options.visibility&&Object.keys(this.props.options.params).reduce(((e,i)=>t.options.params[i]!==this.props.options.params[i]||e),!1)){const e=this.provider,i=this.layer.updateParams(t.options.params);this.layer=i,this.addLayer(t),setTimeout((()=>{this.removeLayer(e)}),1e3)}this.updateLayer(t,this.props)}componentWillUnmount(){this.layer&&this.props.map&&!this.props.map.isDestroyed()&&(this.layer.detached&&this.layer?.remove?this.layer.remove():(this.layer.destroy&&this.layer.destroy(),this.props.map.imageryLayers.remove(this.provider)),this.refreshTimer&&clearInterval(this.refreshTimer))}render(){if(this.props.children){const t=this.layer,e=t?r().Children.map(this.props.children,(e=>e?r().cloneElement(e,{container:t,styleName:this.props.options&&this.props.options.styleName}):null)):null;return r().createElement(r().Fragment,null,e)}return s.default.renderLayer(this.props.type,this.props.options,this.props.map,this.props.map.id,this.layer)}}y(g,"propTypes",{map:h().object,type:h().string,options:h().object,onCreationError:h().func,position:h().number,securityToken:h().string,zoom:h().number});const v=g},62431:(t,e,i)=>{"use strict";i.d(e,{Z:()=>L});var o=i(76180),r=(i(19683),i(63934),i(69819)),s=i(45697),n=i.n(s),a=i(49977),p=i.n(a),h=i(24852),l=i.n(h),c=i(80307),m=i.n(c),d=i(37275);const u=(t,e)=>{var i=t.scene;const r=e.position||e.endPosition;if(!r)return null;const s=t.camera.getPickRay(r),n=t.scene.globe.pick(s,t.scene),a=i._globe.ellipsoid;if(o.defined(n)){const o=a.cartesianToCartographic(n),r=function(t,e){if(null!==e.position){const i=t.scene,o=i._globe.ellipsoid;return i.camera.pickEllipsoid(e.position||e.endPosition,o)}return null}(t,e);return r&&(o.height=i._globe.getHeight(o),o.cartesian=r,o.position=n),o}return null};var y=i(52259),g=i(90183),v=i(27418),f=i.n(v),b=i(23493),P=i.n(b),E=i(18446),C=i.n(E);function T(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class S extends l().Component{constructor(){var t;super(...arguments),t=this,T(this,"state",{}),T(this,"onClick",((t,e)=>{if(this.props.onClick&&null!==e.position){const i=t.camera.pickEllipsoid(e.position,t.scene.globe.ellipsoid);let r=u(t,e)||i&&o.Cartographic.fromCartesian(i);if(r){const t=180*r.latitude/Math.PI,e=180*r.longitude/Math.PI,i=(90-t)/180*this.props.standardHeight*(this.props.zoom+1),o=(180+e)/360*this.props.standardWidth*(this.props.zoom+1);this.props.onClick({pixel:{x:o,y:i},height:this.props.mapOptions&&this.props.mapOptions.terrainProvider?r.height:void 0,cartographic:r,latlng:{lat:t,lng:e},crs:"EPSG:4326"})}}})),T(this,"onMouseMove",(t=>{if(this.props.onMouseMove&&t.endPosition&&this.map?.camera){const e=this.map.camera.pickEllipsoid(t.endPosition,this.map.scene.globe.ellipsoid);let i=u(this.map,t)||e&&o.Cartographic.fromCartesian(e);if(i){const t=Math.round(i.height);this.props.onMouseMove({y:180*i.latitude/Math.PI,x:180*i.longitude/Math.PI,z:t,crs:"EPSG:4326"})}}})),T(this,"getDocument",(()=>this.props.document||document)),T(this,"getMapOptions",(t=>{let e={};if(t.terrainProvider){let{type:i,...r}=t.terrainProvider;switch(i){case"cesium":e.terrainProvider=new o.CesiumTerrainProvider(r);break;case"ellipsoid":e.terrainProvider=new o.EllipsoidTerrainProvider}}return f()({},t,e)})),T(this,"getCenter",(()=>{const t=this.map.camera.positionCartographic;return{longitude:180*t.longitude/Math.PI,latitude:180*t.latitude/Math.PI,height:t.height}})),T(this,"getZoomFromHeight",(t=>Math.log2(this.props.zoomToHeight/t)+1)),T(this,"getHeightFromZoom",(t=>this.props.zoomToHeight/Math.pow(2,t-1))),T(this,"gestureStartListener",(t=>{t.preventDefault()})),T(this,"setMousePointer",(t=>{this.map&&(m().findDOMNode(this).getElementsByClassName("cesium-viewer")[0].style.cursor=t||"auto")})),T(this,"_updateMapPositionFromNewProps",(t=>{const e=this.getCenter(),i=this.getZoomFromHeight(e.height),r=function(t,e){return void 0!==t&&void 0!==e&&t.toFixed(12)-e.toFixed(12)<=1e-12},s=!r(t.center.x,e.longitude)||!r(t.center.y,e.latitude),n=t.zoom!==i;if(s||n){const e={destination:o.Cartesian3.fromDegrees(t.center.x,t.center.y,this.getHeightFromZoom(t.zoom)),orientation:t.viewerOptions.orientation};this.setView(e)}})),T(this,"setView",(t=>{this.props.mapOptions&&this.props.mapOptions.flyTo?this.map.camera.flyTo(t,this.props.mapOptions.defaultFlightOptions):this.map.camera.setView(t)})),T(this,"subscribeClickEvent",(t=>{const e={LEFT_UP:o.ScreenSpaceEventType.LEFT_UP,LEFT_DOWN:o.ScreenSpaceEventType.LEFT_DOWN,LEFT_CLICK:o.ScreenSpaceEventType.LEFT_CLICK,PINCH_START:o.ScreenSpaceEventType.PINCH_START,PINCH_END:o.ScreenSpaceEventType.PINCH_END,PINCH_MOVE:o.ScreenSpaceEventType.PINCH_MOVE},i=new(p().Subject),r=new(p().Subject);Object.keys(e).forEach((t=>this.hand.setInputAction((o=>{r.next({type:e[t],movement:o}),i.next({type:e[t],movement:o})}),e[t]))),r.filter((t=>t.type===e.PINCH_END)).switchMap((()=>p().Observable.of(!0).concat(p().Observable.of(!1).delay(500)))).startWith(!1).switchMap((t=>t?p().Observable.never():i)).filter((t=>t.type===e.LEFT_DOWN)).switchMap((t=>{let{movement:o}=t;return i.filter((t=>t.type===e.LEFT_CLICK)).takeUntil(p().Observable.timer(500).merge(i.filter((t=>{return t.type!==e.LEFT_UP&&t.type!==e.LEFT_CLICK||t.type===e.LEFT_UP&&(i=o&&o.position,r=t.movement&&t.movement.position,!(i&&r&&i.x===r.x&&i.y===r.y));var i,r}))))})).subscribe((e=>{let{movement:i}=e;return this.onClick(t,i)})),this.clickStream$=i,this.pauserStream$=r})),T(this,"registerHooks",(()=>{this.props.hookRegister.registerHook(y.GET_PIXEL_FROM_COORDINATES_HOOK),this.props.hookRegister.registerHook(y.GET_COORDINATES_FROM_PIXEL_HOOK),this.props.hookRegister.registerHook(y.ZOOM_TO_EXTENT_HOOK,(function(e){let{crs:i,duration:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=(0,g.reprojectBbox)(e,i,"EPSG:4326");if(t.map.camera.flyTo){const e=o.Rectangle.fromDegrees(s[0],s[1],s[2],s[3]);t.map.camera.flyTo({destination:e,duration:r,complete:t.updateMapInfoState})}}))})),T(this,"updateMapInfoState",(()=>{const t=this.getCenter(),e=this.getZoomFromHeight(t.height),i={height:Math.round(this.props.standardWidth*(e+1)),width:Math.round(this.props.standardHeight*(e+1))};this.props.onMapViewChanges({x:t.longitude,y:t.latitude,crs:"EPSG:4326"},e,{bounds:{minx:-180,miny:-90,maxx:180,maxy:90},crs:"EPSG:4326",rotation:0},i,this.props.id,this.props.projection,{orientation:{heading:this.map.camera.heading,pitch:this.map.camera.pitch,roll:this.map.camera.roll}},(0,y.getResolutions)()[e])}))}UNSAFE_componentWillMount(){this.getDocument().addEventListener("gesturestart",this.gestureStartListener)}componentDidMount(){const t=document.querySelector(this.props.mapOptions?.attribution?.container||"#footer-attribution-container");let e=new o.Viewer(this.getDocument().getElementById(this.props.id),f()({imageryProvider:new o.OpenStreetMapImageryProvider,baseLayerPicker:!1,animation:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!1,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1,creditContainer:t||void 0},this.getMapOptions(this.props.mapOptions)));this.props.registerHooks&&this.registerHooks(),e.extend(r.Z,{enableCompass:!0,enableZoomControls:this.props.zoomControl,enableDistanceLegend:!1}),e.scene.globe.baseColor=o.Color.WHITE,e.imageryLayers.removeAll(),e.camera.moveEnd.addEventListener(this.updateMapInfoState),this.hand=new o.ScreenSpaceEventHandler(e.scene.canvas),this.subscribeClickEvent(e),this.hand.setInputAction(P()(this.onMouseMove.bind(this),500),o.ScreenSpaceEventType.MOUSE_MOVE),e.camera.setView({destination:o.Cartesian3.fromDegrees(this.props.center.x,this.props.center.y,this.getHeightFromZoom(this.props.zoom))}),this.setMousePointer(this.props.mousePointer),this.map=e,this.forceUpdate(),this.props.mapOptions.navigationTools&&(this.cesiumNavigation=window.CesiumNavigation,this.cesiumNavigation&&this.cesiumNavigation.navigationInitialization(this.props.id,e))}UNSAFE_componentWillReceiveProps(t){return t.mousePointer!==this.props.mousePointer&&this.setMousePointer(t.mousePointer),t.mapStateSource!==this.props.id&&this._updateMapPositionFromNewProps(t),!1}componentDidUpdate(t){if(this.props?.orientate&&t&&!C()(this.props.orientate,t?.orientate)){const t={destination:o.Cartesian3.fromDegrees(parseFloat(this.props.orientate.x),parseFloat(this.props.orientate.y),this.getHeightFromZoom(parseFloat(this.props.orientate.z))),orientation:{heading:parseFloat(this.props.orientate.heading),pitch:parseFloat(this.props.orientate.pitch),roll:parseFloat(this.props.orientate.roll)}};this.setView(t)}}componentWillUnmount(){this.clickStream$.complete(),this.pauserStream$.complete(),this.hand.destroy(),this.getDocument().removeEventListener("gesturestart",this.gestureStartListener),this.map.cesiumNavigation.destroy(),this.map.destroy()}render(){const t=this.map,e=this.props.projection,i=t?l().Children.map(this.props.children,(i=>i?l().cloneElement(i,{map:t,projection:e,onCreationError:this.props.onCreationError,zoom:this.props.zoom}):null)):null;return l().createElement("div",{id:this.props.id},i)}}T(S,"propTypes",{id:n().string,document:n().object,center:d.ZP.PropTypes.center,zoom:n().number.isRequired,mapStateSource:d.ZP.PropTypes.mapStateSource,projection:n().string,onMapViewChanges:n().func,onCreationError:n().func,onClick:n().func,onMouseMove:n().func,mapOptions:n().object,standardWidth:n().number,standardHeight:n().number,mousePointer:n().string,zoomToHeight:n().number,registerHooks:n().bool,hookRegister:n().object,viewerOptions:n().object,orientate:n().object,zoomControl:n().bool}),T(S,"defaultProps",{id:"map",onMapViewChanges:()=>{},onClick:()=>{},onCreationError:()=>{},projection:"EPSG:3857",mapOptions:{},standardWidth:512,standardHeight:512,zoomToHeight:8e7,registerHooks:!0,hookRegister:{registerHook:y.registerHook},viewerOptions:{orientation:{heading:0,pitch:-1*Math.PI/2,roll:0}}});const L=S}}]);